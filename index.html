<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-us">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="content-type" />
  <title>goxtool.py</title>
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body>
<h1>goxtool.py</h1>
goxtool.py is a trading client for the MtGox Bitcoin currency exchange.
It
allows you to watch live market data, to send or cancel orders or to
run a fully automated trading bot. It is designed to work in the Linux
console (sorry, no Windows yet), its written in Python and is using the
(n)curses library to draw its user interface (it does <span
 style="font-weight: bold;">not</span> have a GTK or Qt interface), all
it needs to run is a terminal (either locally or remote through ssh or
putty). <br />
<br />
This program is released under the GNU General Public License, Version
3.<br />
The github project page with source code and issue tracker is here: <a
 href="https://github.com/prof7bit/goxtool">https://github.com/prof7bit/goxtool</a><br />
Donations are welcome: 1D7ELjGofBiRUJNwK55DVC3XWYjfN77CA3<br />
<br />
When goxtool is running it looks like this:<br />
<img style="width: 1024px; height: 743px;"
 alt="goxtool.py screenshot of terminal running goxtool"
 src="screenshot1.png" /><br />
<span style="font-weight: bold;">
</span>
<h2>How to install
</h2>
Open a terminal in an empty folder or in the folder you usually use to
clone
repositories and clone the master branch:<br />
<br />
<pre>git clone git://github.com/prof7bit/goxtool.git</pre>
<br />
This will create a folder named&nbsp;<span class="codeword">goxtool</span>
containing all the needed files. Thats all, now it is installed and
ready to use. You can now already watch live market data (without any
trading functions being enabled), you can later add a MtGox API-key to
it to have full access to your account but for now just proceed to the
next step, start it without an account, just to make sure everything
works.<br />
<h2>How to start it
</h2>
change into to the&nbsp;<span class="codeword">goxtool</span>
folder that was created in the previous step and start
goxtool.py:<br />
<br />
<pre>cd goxtool<br />./goxtool.py</pre>
<br />
Keyboard commands (only the ones useful in view-only mode, without
MtGox
account):<br />
<ul>
  <li><span class="keycmd">q</span>&nbsp;: quit</li>
  <li><span class="keycmd">l</span>&nbsp;: (lower case "L") reload the
strategy module (see advanced
usage)</li>
</ul>
There is also a&nbsp;<span class="codeword">goxtool.ini</span>
file, it will be created on the first start. In the&nbsp;<span
 class="codeword">.ini</span> file
there are some parameters you can change, for example the currency you
want to trade BTC against or some parameters regarding the network
protocol. Some of the&nbsp;<span class="codeword">.ini</span> settings
can be overridden by command line
options (use the&nbsp;<span class="codeword">--help</span> option to
see a list). The default protocol is&nbsp;<span class="codeword">websocket</span>,
the alternative would be&nbsp;<span class="codeword">socketio</span>,
goxtool implements both
protocols but their socketio server is very unreliable, so I recommend
leaving it at the default. There is also an option to use the http API
for trading commands, the default is to send all commands to the
streaming socket, this affects only what happens when you
buy/sell/cancel, it does not affect the streaming update of orderbook
and chart.<br />
<h3>socketio or websocket? Which one is worse?<br />
</h3>
After much experimentation it seems there are only two reasonable
combinations of protocols. If everything at MtGox works then you should
use websocket, this protocol is lightening fast compared to their
socketio server (the reason is not the protocol itself, its their
implementation at MtGox). The disadvantage of the websocket server is
that it has a lot more downtimes, often for many hours and you have to
wait until someone wakes up in Tokyo to reset it while the socketio
server is working most of the time, but its incredibly slow and most of
the time it is not reasonably possible to send trading commands over
the socketio server, therefore here we must combine it with the
--use-http option.<br />
<br />
This means there are essentially only two reasonable combinations of
protocols at the moment (unless they fix their servers). If everything
is ok at MtGox then you start it with websocket, this should be your
first choice, its the fastest protocol of all:<br />
<br />
<pre>./goxtool.py --protocol=websocket</pre>
<br />
If it is weekend or night in Tokyo, MagicalTux is sleeping and the
websocket server is down for many hours then start it with socketio:<br />
<br />
<pre>./goxtool.py --protocol=socketio --use-http</pre>
<br />
The option&nbsp;<span class="codeword">--use-http</span> makes it send
all trading commands over http (buy, sell and cancel will still return
instantly but the commands will be queued and a separate thread will
execute them one after another in the background). You can of course
also try to leave this last option away and send commands via socketio,
this will work but it will lag like crazy, it will be no fun at all.
Likewise you could also combine websocket and http if you want but this
would not give you any advantage, their websocket server always accepts
trading commands instantly, no reason to ever fall back to http.
Essentially the two configurations above are the only two you will ever
need. I hope eventually they will fix their servers and we can always
use websocket and don't need the other protocols at all anymore.<br />
<h2>How to connect it to your MtGox account</h2>
Do the following:<br />
<pre>./goxtool.py --add-secret</pre>
This will now ask you for key, secret and
password. Key and secret
belong to a shared secret that is created by MtGox to authenticate your
trading software against their API. You can request as many keys from
MtGox as you need, every application you connect to your MtGox account
should have its own key, you can also at any time delete the keys again
that you no longer need.<br />
<br />
Now you need a Key/Secret pair for goxtool. Open your web browser, log
in to your MtGox account, click on "Security Center", click on
"Advanced API Key Creation", choose a name for your key (every key will
have a name so you can later easily tell them apart), make sure you
check at least the boxes "Get Info" and "Trade" (this is what the
application will be allowed to do with this key) and then finally click
on "Create Key".<br />
<br />
Now MtGox will create 2 strings of cryptic numbers and letters, the
"API-Key" and the "Secret". Now copy&amp;paste the API-Key into the
terminal where it asked you for "Key", press enter, now it will ask you
for "Secret", copy&amp;paste the Secret into the terminal, press enter
and now it will ask you for a passphrase. It is important to understand
what is going on here. The Key/Secret from above must under no
circumstances ever come into the wrong hands, therefore goxtool won't
just store them in the&nbsp;<span class="codeword">.ini</span> file,
goxtool will encrypt it and thats
what the passphrase is needed for. Choose a secure passphrase (it will
ask you twice to make sure there is no typo), you will also not see
anything in the console (not even "*") while typing, this is not a bug,
this is intentional. Choose a strong passphrase, type it into the
terminal, press enter, repeat the passphrase, press enter again and now
it will tell you that it has been encrypted and saved to the .ini file
and exit.<br />
<br />
Now start goxtool again:<br />
<br />
<pre>./goxtool.py<br />enter passphrase for secret: </pre>
From now on every time you start goxtool it will ask you for the
passphrase in order to be able to decrypt and use the secret. Enter
your passphrase, press enter. Now goxtool will start and you will
notice
that now it is showing your account balance at the top of the window.
Now all trading functions are enabled.<br />
<br />
Keyboard commands for trading:<br />
<ul>
  <li><span class="keycmd">F4</span>&nbsp;: New buy order</li>
  <li><span class="keycmd">F5</span>&nbsp;: New sell order</li>
  <li><span class="keycmd">F6</span>&nbsp;: View orders / cancel
order(s)</li>
</ul>
In the cancel dialog you can move up/down with the arrow keys, use&nbsp;<span
 class="keycmd">INS</span> to select/unselect orders (you can select
multiple orders and cancel them all at once) or if you just quickly
want to cancel only one order just highlight to the order and hit&nbsp;<span
 class="keycmd">F8</span>. It behaves a little bit like deleting files
in midnight commander.<br />
<br />
When entering a new order you can move between the fields with up/down
keys or move to the next field with&nbsp;<span class="keycmd">tab</span>
or&nbsp;<span class="keycmd">enter</span> (but only if you entered a
valid number into the previous field, decimal separator is . (not
comma, even on European computers), send the order with&nbsp;<span
 class="keycmd">enter</span>. <br />
<br />
All dialogs can be closed with&nbsp;<span class="keycmd">F10</span>
or&nbsp;<span class="keycmd">ESC</span>.<br />
<h2>Strategy module, strategy.py</h2>
You can write your own trading bots. There is a file named strategy.py,
it contains a class&nbsp;<span class="codeword">Strategy()</span>
which constitutes a trading bot that by default does nothing (its an
empty skeleton). It has event methods (slots) connected to signals that
will be fired when certain events occur. From within these methods you
can then do arbitrary stuff (peek around in&nbsp;<span class="codeword">gox.orderbook</span>
to see where bids
and asks are located, call&nbsp;<span class="codeword">gox.buy()</span>,&nbsp;<span
 class="codeword">gox.sell()</span>&nbsp; or&nbsp;<span class="codeword">gox.cancel()</span>
methods to build a
fully automated trading bot or you can use the key press slot (it will
be called on all letter keys except&nbsp;<span class="keycmd">l</span>
and&nbsp;<span class="keycmd">q</span>) to build a
semi-automatic bot that reacts to key presses or to influence
parameters
of your bot or anything else you can imagine. Examples of simple bots
will soon follow.<br />
<br />
If you decide to make serious use of this then please create a new
python file for your strategy (make a copy of the default&nbsp;<span
 class="codeword">strategy.py</span>
skeleton), give it a different name and leave&nbsp;<span
 class="codeword">strategy.py</span> alone so it
won't collide with upstream changes you pull from github. By default
goxtool will load&nbsp;<span class="codeword">strategy.py</span> but
you can start it with the&nbsp;<span class="codeword">--strategy</span>
command line option to specify your own strategy module:<br />
<pre>./goxtool --strategy=mybot.py</pre>
You can even edit the file while goxtool is running and then reload it
at runtime (this can be very useful),
just press the&nbsp;<span class="keycmd">l</span> key (lowercase L) and
it will do the following things:<br />
<ul>
  <li>free the currently running instance of&nbsp;<span class="codeword">Strategy()</span>
(your&nbsp;<span class="codeword">__del__()</span>
method will be called)</li>
  <li>re-import the changed module file</li>
  <li>create a new instance of&nbsp;<span class="codeword">Strategy()</span>
and call your<span class="codeword">__init__()</span>
again. </li>
</ul>
You should persist the state of your bot (if needed) during&nbsp;<span
 class="codeword">__del__()</span>
and reload it in&nbsp;<span class="codeword">__init__()</span>. <br />
<br />
Trading functions do NOT block, this means
they also won't return the MtGox order ID, you need to find your own
way of remembering which orders you have sent already. A few moments
(seconds or minutes) after you have sent them they will be acked by
MtGox and it will fire&nbsp;<span class="codeword">orderbook.signal_changed()</span><span
 style="font-family: monospace;">
</span>and when this happens you will find it in the&nbsp;<span
 class="codeword">gox.orderbook.owns</span> list and it
will have an official order ID. I know this is not optimal (because
this part of the code is not yet complete, eventually there will be
dedicated signals to notify your bot about the results of trading
commands) and also this document is not yet a complete documentation.
If you really want to dive into this: use the source, Luke.<br />
<h2>How to keep it up to date</h2>
Occasionally I will commit bugfixes, improvements, etc. To update your
copy of goxtool (assuming you previously installed it with git clone
and not by just downloading a zip file) do the following:<br />
<pre>git pull</pre>
and if that complains because of local uncommitted changes because you
edited the strategy.py module or did other changes to the code then try
this:<br />
<pre>git stash<br />git pull<br />git stash pop</pre>
Of course you could have also have followed my previous advise to not
do anything other than simple throw-away experiments in strategy.py so
you can always git reset --hard if everything else fails and use a
separate file (and probably even separate git branches) for serious bot
development but this is outside the scope of this document, there exist
specialized howtos for git and github elsewhere.<br />
<br />
(TODO: finish writing this howto)
</body>
</html>
